<html>
<head>
    <script lang="javascript">
        var lastMsgId = -1;
        function request(method, path, params) {
            var xhr = new XMLHttpRequest();
            path += "?" + params
            xhr.open(method, encodeURI(path), true);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.onload = function () {
                var chatRoomMessages = document.getElementById('chatRoomMessages');
                lastMsgId = this.responseText.substr(0,this.responseText.indexOf(":"))
                chatRoomMessages.value += this.responseText.substr(this.responseText.indexOf(":")+1)
                chatRoomMessages.scrollTop = chatRoomMessages.scrollHeight;
            };
            console.log(path)
            xhr.send();
        }
        function getMessage() {
            var chatRoom = document.getElementById("currentChatRoom").value
            var xhr = new XMLHttpRequest();
            var path = "/chatRooms/" + chatRoom + "?lastMsgId=" + lastMsgId;
            xhr.open("get", encodeURI(path), true);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.onload = function () {
                var chatRoomMessages = document.getElementById('chatRoomMessages');
                lastMsgId = this.responseText.substr(0,this.responseText.indexOf(":"))
                chatRoomMessages.value += this.responseText.substr(this.responseText.indexOf(":")+1)
                chatRoomMessages.scrollTop = chatRoomMessages.scrollHeight;
            };
            console.log(path)
            xhr.send();
        }
        function sendMessage() {
            var currentChatRoomContent = document.getElementById('currentChatRoom').value;
            var inputMessageContent = document.getElementById('inputMessage').value;
            var params = "inputMessage=" + inputMessageContent + "&lastMsgId=" + lastMsgId;
            request('post', '/chatRooms/' + currentChatRoomContent,params)
        }
        function createChatRoom() {
            lastMsgId = 0;
            document.getElementById('chatRoomMessages').value = '';
            var chatRoomNameContent = document.getElementById('chatRoomName').value;
            document.getElementById('currentChatRoom').value = chatRoomNameContent;
            request('put', '/chatRooms/' + chatRoomNameContent, "lastMsgId=0")
        }
    </script>
</head>
<body onload="setInterval(getMessage, 3000)">
<div>
    <textarea rows="15" cols="120" id="chatRoomMessages" style="resize: none;">chat messages</textarea>
</div>
<div>
    Current ChatRoom:
    <input type="text" readonly="true" id="currentChatRoom" value="default" /><br>
    <input type="text" id="inputMessage" value="messages from chatRoom" />
    <input type="button" value="Send" onclick="sendMessage()" />
    <input type="button" value="Get" onclick="getMessage()" /><br>
    <input type="text" id="chatRoomName" value="default" />
    <input type="button" value="Create or Load" onclick="createChatRoom()" />
</div>
</body>
</html>